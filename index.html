<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>آکادمی سیلانه سبز</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      font-family: Vazirmatn, sans-serif;
      background:#0b1220;
      color:#fff;
    }
    .wrap{max-width:900px;margin:auto;padding:16px;}
    .pill{
      display:inline-block;
      padding:8px 14px;
      border-radius:999px;
      background:#1f2937;
      font-size:14px;
      margin-bottom:12px;
    }
    .card{
      background:#111827;
      border-radius:16px;
      padding:16px;
      margin-top:12px;
    }
    .inp, .select{
      width:100%;
      padding:10px;
      border-radius:10px;
      border:none;
      background:#1f2937;
      color:#fff;
      margin-bottom:8px;
    }
    .btn{
      padding:10px 16px;
      border-radius:12px;
      border:none;
      background:#3b82f6;
      color:#000;
      font-weight:700;
      cursor:pointer;
    }
    .hidden{display:none;}
    .hint{font-size:13px;color:#9ca3af;margin-top:8px;}
  </style>
</head>

<body>
<div class="wrap">

  <!-- نمایش Telegram ID -->
  <div class="pill">
    Telegram ID شما:
    <span id="debugTid" style="font-weight:800;"></span>
  </div>

  <!-- پنل آپلود -->
  <div class="card">
    <h3>آپلود محتوا (ادمین)</h3>

    <input id="upTitle" class="inp" placeholder="عنوان محتوا" />

    <select id="upCategory" class="select">
      <option value="sales">آموزش فروش</option>
      <option value="product">آموزش محصول</option>
      <option value="mindset">نگرشی</option>
      <option value="campaign">کمپین</option>
      <option value="book">خلاصه کتاب</option>
    </select>

    <input id="upFile" type="file" class="inp" />

    <input id="upDurationManual" class="inp hidden"
           placeholder="مدت زمان (ثانیه) - دستی وارد کن" />

    <button id="btnUpload" class="btn">آپلود</button>

    <div class="hint" id="upHint">
      ابتدا تلاش می‌شود مدت از فایل خوانده شود.
    </div>
  </div>

</div>

<script>
/* =====================
   Telegram
===================== */
const tg = window.Telegram?.WebApp;
let TELEGRAM_ID = "unknown";

if (tg) {
  tg.ready();
  TELEGRAM_ID = tg.initDataUnsafe?.user?.id || "unknown";
}

/* نمایش ID روی صفحه */
document.getElementById("debugTid").textContent = TELEGRAM_ID;

/* =====================
   Duration detection
===================== */
function getDurationFromFile(file){
  return new Promise((resolve)=>{
    const url = URL.createObjectURL(file);
    const el = document.createElement(
      file.type.startsWith("video") ? "video" : "audio"
    );
    el.preload = "metadata";
    el.src = url;
    el.onloadedmetadata = () => {
      resolve(Math.floor(el.duration));
      URL.revokeObjectURL(url);
    };
    el.onerror = () => resolve(null);
    setTimeout(()=>resolve(null),2000);
  });
}

/* =====================
   Upload handler (فقط تست)
===================== */
document.getElementById("upFile").addEventListener("change", async ()=>{
  const file = document.getElementById("upFile").files[0];
  const manual = document.getElementById("upDurationManual");
  const hint = document.getElementById("upHint");

  manual.classList.add("hidden");
  if (!file) return;

  hint.textContent = "در حال خواندن مدت از فایل...";
  const dur = await getDurationFromFile(file);

  if (dur && dur > 0) {
    hint.textContent = `مدت تشخیص داده شد: ${dur} ثانیه`;
    manual.dataset.auto = dur;
  } else {
    hint.textContent = "مدت قابل تشخیص نیست، دستی وارد کن.";
    manual.classList.remove("hidden");
    manual.dataset.auto = "";
  }
});

document.getElementById("btnUpload").onclick = ()=>{
  alert("این نسخه فقط برای گرفتن Telegram ID است.\nID خود را کپی کن و بعد این بخش را حذف کن.");
};
</script>
</body>
</html>
